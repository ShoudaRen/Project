<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit" />
    <title>Book Ticket</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="../bootstrap3/js/holder.js"></script>
    <link href="../bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script src="../js/jquery-1.9.1.min.js"></script>
    <script src="../js/UsershowState.js" ></script>

    <!-- modified 11/11/2021 -->
    <link rel="stylesheet" href="../fontAwesome/css/all.css">
    <link rel="stylesheet" href="../CSS/base.css">
    <link rel="stylesheet" href="../CSS/head.css">
    <link rel="stylesheet" href="../CSS/footer.css">
    <link rel="icon" href="../static/ICON.png" type="image/x-icon">

    <style>

        #se {
            font-weight: bolder;
            font-size: larger;
            display: block;
            margin-top: 40px;

        }
        .myService {
            float: left;
            margin: 15px 15px;
            position: relative;
        }
        #servicePart{
            height: 300px;
            width: 100%;
        }
        .superBottom{
            top: 150%;
        }
        #Confirm{
            background-color: #0c52a4;
            color: honeydew;
            border: none;
            height: 30px;
            line-height: 30px;
        }
        #mySeat{
            width: 70px;
        }
        .col-md-4{
            width: 200px;
        }

        input
        {
            color: black;
            outline: none;
            border: none;
        }
        input:hover{
            color: black;
            cursor: text;
        }

        #allPrice{
            width: 160px;
            height: 30px;
            float: right;
        }
        #allPrice input{
            width: 50px;
        }

        #form-create-order th,  #form-create-order td{
            text-align: center;
        }

        #addPassenger{
            background-color: #a94442;
            color: whitesmoke;
            border-radius: 10%;
            margin-left: 610px;
        }
    </style>
</head>

<body>

<div class="top">
    <div class="mid w">
        <div class="logo"><a href="index.html"><img src="../static/logo.png" alt="logo"></a></div>
        <div class="user">
            <div id="tel"><i class="fa fa-phone"></i> TEL:88888888</div>
            <div></div>
            <form id="LogSignup">
                <div class="service"> <i class="fa fa-user"> </i>
                    <a onclick="checkname()"> <input id="userShow" type="button" name="userShow" value="Log In" readonly="readonly"></a> </div>
                <div>|</div>
                <div class="service"><a onclick="checksignout()"><input id="userOutgg" type="button" name="userOut" value="SIGN UP" readonly="readonly"></a> </div>
            </form>
        </div>
    </div>
</div>
<div class="secondmid w">
    <div><a href="help.html">Help and Contacts</a></div>
    <div class="SpecialOffer"><a id="qw" href="Onsalesticket.html">On Sales</a>
    </div>
    <div><a href="userdata.html">Manage</a></div>
    <div><a href="allticket.html">All flights</a></div>
</div>
<div class="container">
    <div class="col-md-offset-1 col-md-10">
        <div class="col-md-4">
            <div id="comfirmOrder" class="col-md-12 order-bar-active">
                1.booking service
                <span class="pull-right"><span class="fa fa-chevron-right"></span></span>
            </div>
        </div>
        <div class="col-md-4">
            <div id="Confirm" class="col-md-12 order-bar-active">
                2.Confirm Order
                <span class="pull-right"><span class="fa fa-chevron-right"></span></span>
            </div>
        </div>
        <div class="col-md-4">
            <div class="col-md-12 order-bar-undo">
                3.Pay Online
                <span class="pull-right"><span class="fa fa-chevron-right"></span></span>
            </div>
        </div>
        <div class="col-md-4">
            <div class="col-md-12 order-bar-undo">
                4.Pay Success
            </div>
        </div>

        <div class="col-md-12">

                <div class="form-group">
                   <form id="passengerForm">
                    <label >
                        <p>Choose Passenger <button id="addPassenger">add Passenger</button></p>
                    </label>
                    <select name="passengerId" id="passengers-list" class="form-control">
                        <option>
                        </option>
                        <option>

                        </option>
                        <option>
                        </option>
                    </select>
                   </form>
                </div>
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <p class="panel-title">Ticket Details：</p>
                    </div>
                    <div class="panel-body">
                        <form id="form-create-order" role="form">
                        <table class="cart-table" width="100%">
                            <thead>
                            <tr>
                                <th width="10%">Airline</th>
                                <th width="8%">Flight Number</th>
                                <th width="10%">Day</th>
                                <th width="14%">Departure Time</th>
                                <th width="12%">Arrival Time</th>
                                <th width="8%">From</th>
                                <th width="8%">To</th>
                                <th width="13%">Entertainment</th>
                                <th width="8%">Price</th>
                                <th width="20%">Number of tickets</th>
                            </tr>
                            </thead>
                            <tbody id="cart-list">
                            <tr>
                                <td>British Airways</td>
                                <td>GP2312</td>
                                <td>11/11/2021</td>
                                <td>11;25AM</td>
                                <td>12:50pm</td>
                                <td>London</td>
                                <td>Shanghai</td>
                                <td>Normal</td>
                                <td>£<span>5298</span></td>
                                <td>100</td>
                            </tr>
                            </tbody>
                        </table>
                        </form>
                        <p id="se">My Service：</p>
                        <form id="myServiceBooking">
                            <div id="servicePart">
                                <div class="myService"><label>My Seat:</label>
                                  <input name="mySeat" id="mySeat" value="seat" readonly="readonly">
                                </div>
                                <div class="myService"><label>Meals:</label>
                                    <input name="meals" id="meals" value="Meals" readonly="readonly">
                                </div>
                                <div class="myService"><label>Airport Pickup:</label>
                                    <input name="pickup" id="pickup" value="pickup" readonly="readonly">
                                </div>
                                <div class="myService"><label>Transit Lounge:</label>
                                    <input name="transitLounge" id="transitLounge" value="transitLounge" readonly="readonly">
                                </div>
                                <div class="myService"><label>Special Services:</label>
                                    <input name="specialServices" id="specialServices" value="specialServices" readonly="readonly">
                                </div>
                                <div class="myService"><label>Transit Hotel:</label>
                                    <input name="transitHotel" id="transitHotel" value="transitHotel" readonly="readonly">
                                </div>
                                <div class="myService"><label>Extra Luggage:</label>
                                    <input name="extraLuggage" id="extraLuggage" value="extraLuggage" readonly="readonly">
                                </div>
                            </div>
                            <div id="allPrice">
                                <span>All Price: </span> <input readonly="readonly" name="totalPrice" id="totalPrice" value="3333"><span>GBP</span>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="pay-bar">
                    <a href="index.html">Return</a>
                    <span class="pull-right"><input id="btn-pay-order" type="button" value="CHECK AND PAY"
                                                    class="btn btn-primary btn-lg link-pay" /></span>
                </div>

        </div>
    </div>
</div>

<!--  footer-->
<div class="superBottom">
    <div class="bottomMiddle w">
        <div class="bottomF">
            <div><a href="javascript:;">Help and contacts</a></div>
            <div class="mark">|</div>
            <div><a href="javascript:;">About Us</a></div>
            <div class="mark">|</div>
            <div><a href="javascript:;">Manage</a></div>
            <div class="mark">|</div>
            <div><a href="javascript:;">Special Offers</a></div>
            <div class="mark">|</div>
            <div><a href="javascript:;">Privacy policy</a></div>
            <div class="mark">|</div>
            <div><a href="javascript:;">Website security</a></div>
        </div>
        <!-- <div class="bottomS"></div> -->
        <div class="copyright">© Super Airways - all rights reserved</div>
        <div class="bottomImg"><img src="../static/logo.png" alt="logo"></div>

    </div>


</div>

<!--SHOW TICKET CHOOSED-->
<script type="text/javascript" >
    $(document).ready(function () {
        showbook();
        showPassengerList();
    });

// update passengid to myservice database
        $("#btn-pay-order").click(function () {
            let passengerId=$("#passengers-list").val();
        $.ajax({
            url:"/tickets/update_pid",
            type:"get",
            data:"passengerId="+passengerId,
            dataType:"JSON",
            success : function(json){
                if(json.state==200){
                    location.href="payPage.html";
                }else { alert("Change Failed");}
            },
            error:function (xhr){
                alert("oops! An unknown error"+" "+xhr.message)
            }
        });
    });

    function  showbook(){
        $.ajax({
            url:"/tickets/ticketInform",
            type:"get",
            dataType:"JSON",
            success : function(json){
                if(json.state==200){
                    let list = json.data;
                        let tr = '    <tr>\n' +
                            '                                <td>BritishAirways</td>\n' +
                            '                                <td>GP2312</td>\n' +
                            '                                <td>day</td>\n' +
                            '                                <td>time1</td>\n' +
                            '                                <td>time2</td>\n' +
                            '                                <td>London</td>\n' +
                            '                                <td>Paris</td>\n' +
                            '                                <td>Normal</td>\n' +
                            '                                <td>£<span>5298</span></td>\n' +
                            '                                <td>numbert</td>\n' +
                            '                            </tr>';

                        tr = tr.replace(/BritishAirway/g,list.company);
                        tr = tr.replace(/GP2312/g,list.flightName);
                        tr = tr.replace(/day/g,list.flightDay);
                        tr = tr.replace(/time1/g,list.takeOffTime);
                        tr = tr.replace(/time2/g,list.fallingOffTime);
                        tr = tr.replace(/London/g,list.fromLocation);
                        tr = tr.replace(/Paris/g,list.toLocation);
                        tr = tr.replace(/Normal/g,list.entertainment);
                        tr = tr.replace(/5298/g,list.ecoPrice);
                        tr = tr.replace(/numbert/g,list.adultNum);
                        $("#cart-list").append(tr);

                }else { alert("Load failed");}
            }

        });
    }
    function  showPassengerList(){
        //clear the inofrmation of select
        $("#passengers-list").empty();
        $.ajax({
            url:"/passengers/",
            type:"POST",
            dataType:"JSON",
            success : function(json){
                if(json.state==200){
                    let list = json.data;

                    for (let i = 0; i < list.length; i++) {
                        //value='#{passengerId}' which is used to deliver information to other page
                        let opt ="<option value='#{passengerId}'>#{First}&nbsp;&nbsp;&nbsp;#{second}&nbsp;&nbsp;&nbsp;#{Passport}&nbsp;&nbsp;&nbsp;#{PassportExpire}&nbsp;&nbsp;&nbsp;" +
                            "#{phone}&nbsp;&nbsp;&nbsp;#{email}</option>";

                        opt=opt.replace(/#{passengerId}/d,list[i].passengerId);
                        opt=opt.replace(/#{First}/d,list[i].firstname);
                        opt=opt.replace(/#{second}/d,list[i].lastname);
                        opt= opt.replace(/#{Passport}/d,list[i].passport);
                        opt=opt.replace(/#{PassportExpire}/d,list[i].passportExpire);
                        opt=opt.replace(/#{phone}/d,list[i].mobilePhone);
                        opt=opt.replace(/#{email}/d,list[i].email);

                        $("#passengers-list").append(opt);
                    }
                }else { alert("load Failed");}
            }
        });
    }

</script>
<!--show user's service-->
<script type="text/javascript">
    $(document).ready(function(){
        $.ajax({
            url:"/tickets/show_service",
            type:"get",
            data:$("#myServiceBooking").serialize(),
            dataType:"JSON",
            success : function(json){
                if(json.state==200){
                    $("#mySeat").val(json.data.mySeat);
                    $("#meals").val(json.data.meals);
                    $("#pickup").val(json.data.pickup);
                    $("#transitLounge").val(json.data.transitLounge);
                    $("#specialServices").val(json.data.specialServices);
                    $("#transitHotel").val(json.data.transitHotel);
                    $("#extraLuggage").val(json.data.extraLuggage);
                    $("#totalPrice").val(json.data.totalPrice);
                }else { alert("data does not exist");}
            }
        });
    });


</script>

<!--add passenger-->
<script type="text/javascript">
    $("#addPassenger").click(function () {
     window.open("addPassenagerpart.html");
    });
</script>









<!--show user's information-->
<script src="../js/User.js"></script>
</body>

</html>